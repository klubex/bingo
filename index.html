<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bingo da Matemática</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --color-primary: #4f46e5;
      --color-primary-light: #6366f1;
      --color-primary-dark: #4338ca;
      --color-accent: #10b981;
      --color-accent-dark: #059669;
      --color-background: #f8fafc;
      --color-surface: #ffffff;
      --color-text-primary: #1e293b;
      --color-text-secondary: #475569;
      --color-border: #e2e8f0;
      --font-family-main: "Poppins", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
      --border-radius: 12px;
      --transition-speed: 0.3s;
    }
    * { box-sizing: border-box; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    html {
        font-size: 16px;
    }
    body {
      font-family: var(--font-family-main);
      background: var(--color-background);
      margin: 0; padding: 0;
      display: flex; flex-direction: column;
      align-items: center; min-height: 100vh;
      color: var(--color-text-primary);
      -webkit-tap-highlight-color: transparent;
    }
    h1 {
      background-color: var(--color-primary);
      color: white; width: 100%; margin: 0;
      padding: 1.5rem 1rem; font-weight: 700;
      text-align: center; box-shadow: var(--shadow-md);
      user-select: none; font-size: 2.25rem;
    }
    main {
      max-width: 900px; width: 100%;
      padding: 0 1rem;
      margin-top: 1.5rem;
      flex-grow: 1; text-align: center;
      position: relative;
    }
    .hidden { display: none !important; }
    button {
      background-color: var(--color-primary);
      border: none; border-radius: var(--border-radius);
      color: white; padding: 0.8em 1.5em;
      font-size: 1.1rem; font-weight: 600;
      font-family: inherit; margin: 0.5rem; cursor: pointer;
      transition: all var(--transition-speed) ease;
      user-select: none; box-shadow: var(--shadow-sm);
    }
    button:hover:not(:disabled) {
      background-color: var(--color-primary-light);
      transform: translateY(-2px); box-shadow: var(--shadow-md);
    }
    button:active:not(:disabled) {
      transform: translateY(0px) scale(0.98); box-shadow: var(--shadow-sm);
    }
    button:disabled {
      background-color: #94a3b8; cursor: not-allowed;
      transform: none; box-shadow: var(--shadow-sm);
    }
    .btn-voltar {
        background-color: transparent;
        color: var(--color-text-secondary);
        border: 2px solid var(--color-border);
        padding: 0.5em 1em;
        font-size: 0.9rem;
        margin-bottom: 1.25rem;
        display: inline-block;
        float: left;
    }
    .btn-voltar:hover:not(:disabled) {
        background-color: var(--color-background);
        border-color: var(--color-text-secondary);
        color: var(--color-text-primary);
    }
    .btn-secondary {
        background-color: var(--color-text-secondary);
    }
    .btn-secondary:hover:not(:disabled) {
        background-color: var(--color-text-primary);
    }
    input[type="text"] {
      font-size: 1.1rem; font-family: inherit;
      padding: 0.8rem 1rem; width: 100%; max-width: 350px;
      margin: 0.5rem 0 1.25rem 0; border: 2px solid var(--color-border);
      border-radius: var(--border-radius); outline: none;
      transition: all var(--transition-speed) ease;
      background-color: var(--color-background);
    }
    input[type="text"]:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.2);
      background-color: var(--color-surface);
    }
    .card {
      background: var(--color-surface);
      border-radius: 16px; padding: 2rem 2.5rem;
      box-shadow: var(--shadow-lg); margin-bottom: 2.5rem;
      animation: fadeIn 0.5s ease-out forwards;
      clear: both;
    }
    h2 {
      font-weight: 700; font-size: 1.75rem;
      margin-top: 0; margin-bottom: 1.8rem;
      color: var(--color-text-primary);
    }
    #cartela {
      display: grid; grid-template-columns: repeat(4, 1fr);
      gap: 1rem; max-width: 400px;
      margin: 1.5rem auto; user-select: none;
    }
    .cell {
      background-color: #f1f5f9; aspect-ratio: 1 / 1;
      display: flex; align-items: center; justify-content: center;
      border-radius: var(--border-radius); font-size: 1.75rem;
      font-weight: 700; cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s ease-in-out; user-select: none;
    }
    .cell:not(.marked):hover {
        transform: translateY(-4px); box-shadow: var(--shadow-md);
        border-color: var(--color-primary-light);
    }
    .cell.marked {
      background-color: var(--color-accent); color: white;
      border-color: var(--color-accent-dark); transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4); cursor: default;
    }
    #bingo-notification, #cartela-numero, #welcome-msg, #professor-gabarito, #professor-winners {
        user-select: none;
    }
    #professor-equation { user-select: text; }
    #bingo-notification {
      margin-top: 1.5rem; font-weight: 700;
      font-size: 2rem; color: var(--color-accent-dark);
      min-height: 2.5rem;
    }
    #cartela-numero {
      font-style: italic; margin-top: 0.5rem;
      font-weight: 600; color: var(--color-text-secondary);
    }
    #welcome-msg {
      max-width: 600px; margin: 0 auto 1.5rem auto;
      line-height: 1.7; color: var(--color-text-secondary);
      font-size: 1.1rem;
    }
    #professor-equation {
      font-size: 2rem; font-weight: 700;
      margin: 1.5rem 0; padding: 1.25rem;
      background-color: #eef2ff;
      border-radius: var(--border-radius);
      color: var(--color-primary-dark);
      border: 2px dashed var(--color-primary-light);
      word-wrap: break-word;
    }
    #professor-gabarito {
      margin-top: 1.5rem; max-height: 300px;
      overflow-y: auto; border: 1px solid var(--color-border);
      padding: 1.25rem; border-radius: var(--border-radius);
      background: var(--color-background);
      font-family: "SF Mono", "Fira Code", "Source Code Pro", monospace;
      font-size: 1rem; white-space: pre-wrap;
      text-align: left;
    }
    #professor-winners {
      margin-top: 1.25rem; font-weight: 700;
      color: var(--color-accent-dark); font-size: 1.3rem;
    }

    @media (max-width: 768px) {
        html { font-size: 14px; }
        .card { padding: 1.5rem 1.25rem; }
        .card button:not(.btn-voltar) {
            width: 100%;
            margin-left: 0;
            margin-right: 0;
        }
        #cartela { gap: 0.5rem; }
        .cell:not(.marked):hover {
            transform: none;
            box-shadow: none;
        }
        .cell:not(.marked):active {
             transform: scale(0.95);
        }
    }
  </style>
</head>
<body>
  <h1>Bingo da Matemática</h1>
  <main>
    <button id="btnVoltarInicio" class="btn-voltar hidden">← Voltar ao Início</button>
    
    <section id="inicio" class="card">
      <h2>Quem é Você?</h2>
      <button id="btnAluno">Sou Aluno</button>
      <button id="btnProfessor">Sou Professor</button>
    </section>
    
    <section id="tipo-equacao" class="card hidden">
      <h2>Escolha o tipo de Equação</h2>
      <button data-tipo="1grau">Equações do 1º Grau</button>
      <button data-tipo="2grau">Equações do 2º Grau</button>
      <button data-tipo="misturado">Equações Mistas</button>
    </section>

    <section id="nome-aluno" class="card hidden">
      <h2>Qual o seu nome?</h2>
      <input type="text" id="input-nome" placeholder="Digite seu nome aqui" autocomplete="off" />
      <button id="btnAvancarAluno">Avançar</button>
    </section>

    <section id="jogo-aluno" class="card hidden">
      <p id="welcome-msg"></p>
      <div>
        <button id="btn-gerar-cartela">Gerar Minha Cartela!</button>
        <button id="btn-reiniciar-aluno" class="btn-secondary hidden">Jogar Novamente</button>
      </div>
      <div id="cartela-numero"></div>
      <div id="cartela"></div>
      <div id="bingo-notification"></div>
    </section>

    <section id="professor-area" class="card hidden">
      <h2>Área do Professor</h2>
      <div>
        <button id="btn-exibir-equacao">Sortear Nova Equação</button>
        <button id="btn-gabarito">Mostrar Gabarito e Vencedores</button>
        <button id="btn-reiniciar-professor" class="btn-secondary">Nova Rodada</button>
      </div>
      <div id="professor-equation" aria-live="polite" role="status">Aguardando sorteio...</div>
      <div id="professor-gabarito" class="hidden"></div>
      <div id="professor-winners" class="hidden"></div>
    </section>
  </main>

 <audio id="audio-bingo" src="https://actions.google.com/sounds/v1/notifications/notification_simple.ogg" preload="auto"></audio>

<script>
(() => {
  // --- BANCO DE DADOS INTERNO ---
  const eq1Grau = [];
  while (eq1Grau.length < 30) {
    let a = Math.floor(Math.random() * 9) + 1;
    if (Math.random() < 0.5) a = -a;
    let x = Math.floor(Math.random() * 21) - 10;
    let b = Math.floor(Math.random() * 41) - 20;
    let c = a * x + b;
    const bStr = b === 0 ? '' : (b > 0 ? ` + ${b}` : ` - ${Math.abs(b)}`);
    const strEq = `${a === 1 ? '' : (a === -1 ? '-' : a)}x${bStr} = ${c}`;
    if (!eq1Grau.some(e => e.eq === strEq)) {
      eq1Grau.push({ eq: strEq, res: x, detal: `${a}x = ${c - b}  =>  x = ${x}` });
    }
  }

  const eq2Grau = [];
  while (eq2Grau.length < 30) {
    let a = Math.random() < 0.5 ? 1 : -1;
    let x1 = Math.floor(Math.random() * 21) - 10;
    let x2 = Math.floor(Math.random() * 21) - 10;
    if (x1 === x2) continue;
    let b = -a * (x1 + x2);
    let c = a * x1 * x2;
    const aStr = a === 1 ? '' : '-';
    const bStr = b === 0 ? '' : `${b > 0 ? ' + ' : ' - '}${Math.abs(b)}x`;
    const cStr = c === 0 ? '' : `${c > 0 ? ' + ' : ' - '}${Math.abs(c)}`;
    const strEq = `${aStr}x²${bStr}${cStr} = 0`;
    if (!eq2Grau.some(e => e.eq === strEq)) {
      eq2Grau.push({ eq: strEq, res: [x1, x2].sort((n1, n2) => n1 - n2), detal: `Raízes x₁=${x1}, x₂=${x2}` });
    }
  }

  const cartelas = { '1grau': [], '2grau': [], 'misturado': [] };
  function gerarCartelaNumeros() {
    const numeros = new Set();
    while (numeros.size < 16) {
      numeros.add(Math.floor(Math.random() * 21) - 10);
    }
    return Array.from(numeros);
  }
  for (let tipo of Object.keys(cartelas)) {
    for (let i = 0; i < 20; i++) {
      cartelas[tipo].push(gerarCartelaNumeros());
    }
  }

  // --- GESTÃO DE ESTADO ---
  const getEstadoInicial = () => ({
    usuario: null, tipoEquacao: null, nomeAluno: '',
    cartelaAluno: null, cartelaAlunoID: null,
    professorEquacoesSorteadas: [], professorIndexSorteio: 0,
    bingoAnunciado: false,
  });
  let estado = getEstadoInicial();

  // --- ELEMENTOS DO DOM ---
  const sections = {
    inicio: document.getElementById('inicio'),
    tipoEquacao: document.getElementById('tipo-equacao'),
    nomeAluno: document.getElementById('nome-aluno'),
    jogoAluno: document.getElementById('jogo-aluno'),
    professorArea: document.getElementById('professor-area'),
  };
  const btnVoltarInicio = document.getElementById('btnVoltarInicio');
  const welcomeMsg = document.getElementById('welcome-msg');
  const btnGerarCartela = document.getElementById('btn-gerar-cartela');
  const btnReiniciarAluno = document.getElementById('btn-reiniciar-aluno');
  const cartelaNumero = document.getElementById('cartela-numero');
  const cartelaGrid = document.getElementById('cartela');
  const bingoNotification = document.getElementById('bingo-notification');
  const audioBingo = document.getElementById('audio-bingo');
  const btnExibirEquacao = document.getElementById('btn-exibir-equacao');
  const btnGabarito = document.getElementById('btn-gabarito');
  const btnReiniciarProfessor = document.getElementById('btn-reiniciar-professor');
  const professorEquation = document.getElementById('professor-equation');
  const professorGabarito = document.getElementById('professor-gabarito');
  const professorWinners = document.getElementById('professor-winners');

  // --- CONTROLE DE NAVEGAÇÃO E FLUXO ---
  function mostrarTela(nomeTela) {
    Object.values(sections).forEach(s => s.classList.add('hidden'));
    sections[nomeTela].classList.remove('hidden');
    btnVoltarInicio.classList.toggle('hidden', nomeTela === 'inicio');
  }

  function resetarParaOInicio() {
      estado = getEstadoInicial();
      document.getElementById('input-nome').value = '';
      resetarJogoAluno();
      resetarJogoProfessor();
      mostrarTela('inicio');
  }

  btnVoltarInicio.onclick = resetarParaOInicio;

  document.getElementById('btnAluno').onclick = () => {
    estado.usuario = 'aluno';
    mostrarTela('tipoEquacao');
  };

  document.getElementById('btnProfessor').onclick = () => {
    const senha = prompt("Digite a senha do professor:");
    if (senha === 'bingodamatematica') {
      estado.usuario = 'professor';
      mostrarTela('tipoEquacao');
    } else if (senha !== null) {
      alert('Senha incorreta!');
    }
  };

  document.querySelectorAll('#tipo-equacao button').forEach(btn => {
    btn.onclick = () => {
      estado.tipoEquacao = btn.dataset.tipo;
      if (estado.usuario === 'aluno') {
        mostrarTela('nomeAluno');
        document.getElementById('input-nome').focus();
      } else {
        iniciarProfessor();
      }
    };
  });
  
  // --- LÓGICA DO JOGO: ALUNO ---
  function resetarJogoAluno() {
    cartelaGrid.innerHTML = '';
    cartelaNumero.textContent = '';
    bingoNotification.textContent = '';
    btnGerarCartela.style.display = 'inline-block';
    btnReiniciarAluno.classList.add('hidden');
    estado.bingoAnunciado = false;
  }
  
  function iniciarJogoAluno() {
    mostrarTela('jogoAluno');
    welcomeMsg.textContent = `Olá, ${estado.nomeAluno}! Resolva a equação do professor e marque o resultado na sua cartela. Complete uma linha, coluna ou diagonal para gritar BINGO!`;
    resetarJogoAluno();
  }
  
  btnReiniciarAluno.onclick = iniciarJogoAluno;

  document.getElementById('btnAvancarAluno').onclick = () => {
    const nome = document.getElementById('input-nome').value.trim();
    if (!nome) {
      alert("Por favor, digite seu nome!");
      return;
    }
    estado.nomeAluno = nome;
    iniciarJogoAluno();
  };
  
  document.getElementById('input-nome').addEventListener('keyup', (event) => {
    if (event.key === 'Enter') document.getElementById('btnAvancarAluno').click();
  });

  btnGerarCartela.onclick = () => {
    const listaCartelas = cartelas[estado.tipoEquacao];
    const idCartela = Math.floor(Math.random() * listaCartelas.length);
    estado.cartelaAluno = listaCartelas[idCartela];
    estado.cartelaAlunoID = idCartela + 1;

    cartelaGrid.innerHTML = '';
    estado.cartelaAluno.forEach(valor => {
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.textContent = valor;
      cell.onclick = () => {
        if (cell.classList.contains('marked') || estado.bingoAnunciado) return;
        cell.classList.add('marked');
        verificarBingoAluno();
      };
      cartelaGrid.appendChild(cell);
    });

    cartelaNumero.textContent = `Sua cartela é a de nº ${estado.cartelaAlunoID}`;
    btnGerarCartela.style.display = 'none';
    btnReiniciarAluno.classList.remove('hidden');
  };

  function verificarBingoAluno() {
    const cells = [...cartelaGrid.children];
    const eMarcado = (index) => cells[index].classList.contains('marked');
    const vitorias = [
      [0,1,2,3], [4,5,6,7], [8,9,10,11], [12,13,14,15], // Linhas
      [0,4,8,12], [1,5,9,13], [2,6,10,14], [3,7,11,15], // Colunas
      [0,5,10,15], [3,6,9,12] // Diagonais
    ];
    for (const vitoria of vitorias) {
      if (vitoria.every(eMarcado)) {
        anunciarBingo();
        break;
      }
    }
  }

  function anunciarBingo() {
    if (estado.bingoAnunciado) return;
    estado.bingoAnunciado = true;
    bingoNotification.innerHTML = "🎉 BINGO! 🎉<br/>Você venceu!";
    audioBingo.play();
  }

  // --- LÓGICA DO JOGO: PROFESSOR ---
  function resetarJogoProfessor() {
    estado.professorEquacoesSorteadas = [];
    estado.professorIndexSorteio = 0;
    
    professorEquation.textContent = 'Aguardando sorteio...';
    professorGabarito.classList.add('hidden');
    professorWinners.classList.add('hidden');
    
    btnExibirEquacao.disabled = false;
    btnGabarito.disabled = true;
  }

  function iniciarProfessor() {
    mostrarTela('professorArea');
    resetarJogoProfessor();
  }

  btnReiniciarProfessor.onclick = resetarJogoProfessor;

  btnExibirEquacao.onclick = () => {
    let equacoesDisponiveis;
    if (estado.tipoEquacao === '1grau') equacoesDisponiveis = eq1Grau;
    else if (estado.tipoEquacao === '2grau') equacoesDisponiveis = eq2Grau;
    else equacoesDisponiveis = [...eq1Grau, ...eq2Grau];

    const jaSorteadas = new Set(estado.professorEquacoesSorteadas.map(e => e.eq));
    const naoSorteadas = equacoesDisponiveis.filter(e => !jaSorteadas.has(e.eq));
    
    if (naoSorteadas.length === 0) {
      professorEquation.textContent = 'Todas as equações foram sorteadas!';
      btnExibirEquacao.disabled = true;
      return;
    }
    const sorteada = naoSorteadas[Math.floor(Math.random() * naoSorteadas.length)];
    estado.professorEquacoesSorteadas.push(sorteada);
    estado.professorIndexSorteio++;

    professorEquation.textContent = `Equação ${estado.professorIndexSorteio}: ${sorteada.eq}`;
    btnGabarito.disabled = false;
    professorGabarito.classList.add('hidden');
    professorWinners.classList.add('hidden');
  };

  btnGabarito.onclick = () => {
    let gabaritoTxt = "Gabarito das equações sorteadas:\n\n";
    estado.professorEquacoesSorteadas.forEach((e, i) => {
      const resTxt = Array.isArray(e.res) ? e.res.join(', ') : e.res;
      gabaritoTxt += `${i+1}) ${e.eq}\n   Resposta(s): ${resTxt}\n   (${e.detal})\n\n`;
    });
    professorGabarito.textContent = gabaritoTxt;
    professorGabarito.classList.remove('hidden');

    const vencedoras = verificarCartelasVencedoras();
    if (vencedoras.length === 0) {
      professorWinners.textContent = "Nenhuma cartela fez BINGO ainda.";
    } else {
      professorWinners.textContent = "Cartelas com BINGO: Nº " + vencedoras.join(', Nº ');
    }
    professorWinners.classList.remove('hidden');
  };

  function verificarCartelasVencedoras() {
    const respostasSorteadas = new Set();
    estado.professorEquacoesSorteadas.forEach(eq => {
      Array.isArray(eq.res) ? eq.res.forEach(r => respostasSorteadas.add(r)) : respostasSorteadas.add(eq.res);
    });

    const vitorias = [
      [0,1,2,3], [4,5,6,7], [8,9,10,11], [12,13,14,15],
      [0,4,8,12], [1,5,9,13], [2,6,10,14], [3,7,11,15],
      [0,5,10,15], [3,6,9,12]
    ];
    let cartelasVencedoras = [];
    const listaCartelas = cartelas[estado.tipoEquacao];

    listaCartelas.forEach((cartela, idx) => {
      for (const vitoria of vitorias) {
        if (vitoria.every(pos => respostasSorteadas.has(cartela[pos]))) {
          cartelasVencedoras.push(idx + 1);
          break; // Evita adicionar a mesma cartela múltiplas vezes
        }
      }
    });
    return cartelasVencedoras;
  }

  // --- INICIALIZAÇÃO DA APLICAÇÃO ---
  mostrarTela('inicio');
})();
</script>
<p style="text-align: center; font-size: 14px;">
  <em>Projeto criado por Klauber Tavares de Almeida - contato: <a href="mailto:klaubertavares@gmail.com">klaubertavares@gmail.com</a></em>
</p>
</body>
</html>